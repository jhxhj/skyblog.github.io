{"meta":{"title":"Hexo","subtitle":"","description":"","author":"John Doe","url":"http://yoursite.com","root":"/"},"pages":[{"title":"404 Not Found：该页无法显示","date":"2020-05-26T06:33:02.341Z","updated":"2020-05-26T06:33:02.341Z","comments":false,"path":"/404.html","permalink":"http://yoursite.com/404.html","excerpt":"","text":""},{"title":"关于","date":"2020-05-26T06:33:02.342Z","updated":"2020-05-26T06:33:02.342Z","comments":false,"path":"about/index.html","permalink":"http://yoursite.com/about/index.html","excerpt":"","text":"个人详细介绍"},{"title":"书单","date":"2020-05-26T06:23:41.687Z","updated":"2020-05-26T06:23:41.687Z","comments":false,"path":"books/index.html","permalink":"http://yoursite.com/books/index.html","excerpt":"","text":""},{"title":"分类","date":"2020-05-27T03:28:33.000Z","updated":"2020-05-27T03:28:45.745Z","comments":false,"path":"categories/index.html","permalink":"http://yoursite.com/categories/index.html","excerpt":"","text":"个人"},{"title":"友情链接","date":"2020-05-26T06:33:05.382Z","updated":"2020-05-26T06:33:05.382Z","comments":true,"path":"links/index.html","permalink":"http://yoursite.com/links/index.html","excerpt":"","text":""},{"title":"run shell test","date":"2020-05-27T03:26:57.000Z","updated":"2020-05-27T03:26:57.609Z","comments":true,"path":"run-shell-test/index.html","permalink":"http://yoursite.com/run-shell-test/index.html","excerpt":"","text":""},{"title":"Repositories","date":"2020-05-26T09:12:37.594Z","updated":"2020-05-26T09:12:37.594Z","comments":false,"path":"repository/index.html","permalink":"http://yoursite.com/repository/index.html","excerpt":"","text":""},{"title":"run test","date":"2020-05-27T03:26:49.000Z","updated":"2020-05-27T04:13:37.267Z","comments":true,"path":"run-test/index.html","permalink":"http://yoursite.com/run-test/index.html","excerpt":"","text":""},{"title":"标签","date":"2020-05-27T04:14:20.000Z","updated":"2020-05-27T04:14:20.220Z","comments":false,"path":"tags/index.html","permalink":"http://yoursite.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"run shell test","slug":"run-shell-test","date":"2020-05-27T03:26:30.000Z","updated":"2020-05-27T03:26:31.022Z","comments":true,"path":"2020/05/27/run-shell-test/","link":"","permalink":"http://yoursite.com/2020/05/27/run-shell-test/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"ELK安装","slug":"test","date":"2020-05-26T10:38:00.000Z","updated":"2020-05-27T05:10:06.251Z","comments":true,"path":"2020/05/26/test/","link":"","permalink":"http://yoursite.com/2020/05/26/test/","excerpt":"","text":"1.安装环境 1.1安装elasticsearch,kibana,logstash yum install java -y wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.4.rpm wget https://artifacts.elastic.co/downloads/logstash/logstash-6.2.4.rpm rpm -ivh logstash-6.2.4.rpm rpm -ivh kibana-6.2.4-x86_64.rpm rpm -ivh logstash-6.2.4.rpm 编辑配置文件 因为是集群，所有三台都需要安装ES，配置里名字不相同，xpack开始可以先不启用。 vi /etc/elasticsearch/elasticsearch.yml cluster.name: jj-cluster node.name: jjmaster-node #node.name: 192.168.147.82 node.master: true node.data: false network.host: jjmaster-node #network.host: 192.168.147.82 http.port: 9200 discovery.zen.ping.unicast.hosts: [“192.168.147.82”, “192.168.147.125”, “192.168.147.110”] path.repo: [&quot;/jjdata/bak&quot;] bootstrap.system_call_filter: false xpack.security.enabled: true xpack.security.transport.ssl.enabled: true xpack.security.transport.ssl.verification_mode: certificate xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12 xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12 xpack.notification.email.account: exchange_account: profile: outlook email_defaults: from: jh@163.com smtp: auth: true starttls.enable: false host: smtp.163.com port: 25 user: jh@163.com password: Jj 证书存放位置 /etc/elasticsearch/certs/elastic-certificates.p12 /usr/share/elasticsearch/certs/elastic-certificates.p12 vi /etc/security/limits.conf（配置了memory_lock需要增加二个无限） elk soft nofile 819200 elk hard nofile 819200 elk soft memlock unlimited elk hard memlock unlimited echo ‘ulimit -SHn 65536’ &gt;&gt; /etc/profile（如有此项的要删除或是改大） vi /etc/sysctl.conf vm.max_map_count=262144 sysctl -p vi /etc/security/limits.d/90-nproc.conf * soft nproc 1024 修改为： * soft nproc 2048 修改JVM.OPTIONS默认内容容量（默认2G） -Xms256m -Xmx256m 创建运行帐号（此步为TAR包安装，es不能使用root帐号启动，如果是rpm安装可以忽略 [root@elk bin]# useradd elk [root@elk bin]# passwd elk [root@elk app]# chown elk:elk elasticsearch-5.5.2 -R [root@elk app]# mkdir /jjdata/bak （备份目录二种安装方式都需要） [root@elk app]# chown elk:elk /jjhdata/bak -R su - elk -c /jjhdata/app/elasticsearch-5.5.2/bin/elasticsearch 执行进行测试 安装x-pack ./elasticsearch-plugin install x-pack 修改默认账户信息 • Elasticsearch 的默认账户为 elastic 默认密码为 changme curl -XPUT -u elastic ‘http://localhost:9200/_xpack/security/user/elastic/_password’ -d '{ “password” : “yourpasswd” }'s curl -XPUT -u elastic ‘http://localhost:9200/_xpack/security/user/kibana/_password’ -d '{ “password” : “yourpasswd” 执行测试x-pack是否正常 curl -XGET -u elastic:changeme http://192.168.147.82:9200/ 其中x-pack是商用版本可以申请试用，或是免费基本1年的，又或是得参考网上CC 将编辑好的license.json文件放到服务器，在文件目录下执行： [root@localhost Downloads]#curl -XPUT -u elastic:changeme ‘http://192.168.147.82:9200/_xpack/license’ -d @license.json 或者下面： [root@localhost Downloads]#curl -XPUT -u elastic:changeme ‘http://192.168.147.82:9200/_xpack/license?acknowledge=true’ -d @license.json curl -XPUT -u elastic:changeme ‘http://192.168.147.82:9200/_xpack/license?acknowledge=true’ -d @xing-489611f8-974f-4650-b828-51d9cddcce29-v5.json 重启elasticsearch和kibana . 查看当前的license [root@localhost Downloads]# curl -XGET -u elastic:changeme ‘http://192.168.147.82:9200/_license’ 1.2 设置kibana elasticsearch.url: “http://192.168.176.82:9200” elasticsearch.username: “kibana” elasticsearch.password: “jjdd” tilemap.url: ‘http://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&amp;size=1&amp;scale=1&amp;style=7&amp;x={x}&amp;y={y}&amp;z={z}’ #地图使用 破解X-PACK cd /usr/share/kibana/plugins/x-pack/ 修改 _xpack_info.js 删除/usr/share/kibana/optimize/ 启动 service kibana start 登录帐号密码 elastic:changeme 登录后可以修改密码，修改kibana密码后需要在kibana 配置文件里修改 安装nginx nginx.conf worker_processes auto; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 8080; server_name elk.test.com; location / { proxy_pass http://elk.test.com:5601; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection ‘upgrade’; proxy_set_header Host $host; proxy_cache_bypass http_upgrade; } } server { listen 443 ssl; server_name elk.test.com; ssl on; ssl_certificate /usr/local/nginx/test.crt; ssl_certificate_key /usr/local/nginx/test.key; ssl_ciphers ECDH:AESGCM:HIGH:!RC4:!DH:!MD5:!aNULL:!eNULL; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; ssl_session_timeout 5m; ssl_session_cache builtin:1000 shared:SSL:10m; resolver 8.8.4.4 8.8.8.8 valid=300s; resolver_timeout 10s; add_header Strict-Transport-Security max-age=63072000; add_header X-Content-Type-Options nosniff; server_tokens off; location ~\\.htc(|/){ return 404; } location ~ ^(.*)/.svn/{ return 404; } location / { proxy_pass http://elk.test.com:5601; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection 'upgrade'; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; } } } 启动，开启防火墙端口，打开测试 三， 安装redis wget http://download.redis.io/releases/redis-3.2.5.tar.gz tar zxvf redis-3.2.5.tar.gz cd redis-3.2.5 yum -y install tcl ruby tree gcc gcc-c++ make make MALLOC=libc(如有这样的错误error: jemalloc/jemalloc.h: No such fileor directory执行） make test mkdir /data/redis/conf /data/redis/log /data/redis/data make PREFIX=/data/redis/ install 通过vim命令修改 daemonize yes 介个是设置服务在后台运行 2、执行./utils/install_server.sh配置Redis配置之后Redis能随系统启动。 vi /etc/logstash/conf.d/logstash_nginx.conf input { file { path =&gt; [&quot;/usr/local/nginx/logs/access.log&quot;] type =&gt; “nginx_log” start_position =&gt; “beginning” } } output { redis { host =&gt; “192.168.2.221” key =&gt; ‘logstash-redis’ data_type =&gt; ‘channel’ #此处的配置类型要与取redis的数据类型对应 ，一般为list } } 在redis服务器上执行 redis-cli 127.0.0.1:6379&gt; SUBSCRIBE logstash-redis 查看是否收集到nginx日志 正常后修改data_type插入到redis中 四、安装配置logstash vi /etc/logstash/logstash.yml xpack.monitoring.enabled: true xpack.monitoring.elasticsearch.url: [“http://192.168.147.82:9200”] xpack.monitoring.elasticsearch.username: “logstash” xpack.monitoring.elasticsearch.password: “//jjdf” cd /usr/share/logstash/ ln -s /etc/logstash ./config ./system-install /etc/logstash/startup.options sysv echo ‘export “PATH=/usr/share/logstash/bin:$PATH”’ &gt; /etc/profile.d/logstash.sh source /etc/profile.d/logstash.sh logstash -e 'input { stdin { } } output { stdout {codec=&gt;rubydebug} }'测试 mkdir /etc/logstash/patterns 安装 x-pack插件（如不装插件无法进行连接） /etc/logstash/conf.d/放导入配置文件 添加权限用户，kibana添加用户需要先添加role，网页里添加时不能添加.kibana索引的权限，在加任何一个通过kibana查看的用户都需要具体.kibana的权限才可以查看。 curl -XPOST -u elastic ‘elk.test.com:9200/_xpack/security/role/kibana_guest’ -d ‘{ “indices” : [ { “names” : [ “.kibana*” ], “privileges” : [ “manage”, “read”, “index” ] } ] }’","categories":[{"name":"测试","slug":"测试","permalink":"http://yoursite.com/categories/%E6%B5%8B%E8%AF%95/"}],"tags":[{"name":"测试","slug":"测试","permalink":"http://yoursite.com/tags/%E6%B5%8B%E8%AF%95/"}],"author":"John Doe"},{"title":"Hello World","slug":"hello-world","date":"2020-05-26T02:44:41.361Z","updated":"2020-05-26T02:44:41.361Z","comments":true,"path":"2020/05/26/hello-world/","link":"","permalink":"http://yoursite.com/2020/05/26/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start Create a new post 1$ hexo new \"My New Post\" More info: Writing Run server 1$ hexo server More info: Server Generate static files 1$ hexo generate More info: Generating Deploy to remote sites 1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[{"name":"测试","slug":"测试","permalink":"http://yoursite.com/categories/%E6%B5%8B%E8%AF%95/"}],"tags":[{"name":"测试","slug":"测试","permalink":"http://yoursite.com/tags/%E6%B5%8B%E8%AF%95/"}]}